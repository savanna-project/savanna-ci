- job:
    name: gate-savanna-coverage
    project-type: freestyle
    defaults: global
    description: "<b>Title</b>: Part of the gating process.<br/>\
                  \n<b>Description</b>: This job runs tox -e cover (runs all unit tests using nose tests and python 2.7 and calculate coverage)<br/>\
                  \n<b>Maintainer</b>: Sergey Lukjanov<br/>"
    disabled: true
    concurrent: true

    scm:
     - git:
        url: ssh://savanna-ci@review.openstack.org:29418/stackforge/savanna.git
        refspec: $GERRIT_REFSPEC
        name:
        skip-tag: true
        wipe-workspace: false
        strategy: gerrit
        branches:
         - master

    triggers:
        - gerrit:
            trigger-on-patchset-uploaded-event: true
            failure-message:
            projects:
                - project-compare-type: 'PLAIN'
                  project-pattern: 'stackforge/savanna'
                  branch-compare-type: 'PLAIN'
                  branch-pattern: 'master'

    wrappers:
      - timeout:
          timeout: 15
          fail: true
          faildescription: true

    builders:
    - shell: "rm -rf .tox\
             \ntox -e cover"



    publishers:
      - email:
          recipients: slukjanov@mirantis.com
      - cobertura:
           report-file: "savanna/tests/coverage.xml"
           fail-no-reports: "true"
           targets:
                - line:
                    healthy: 80
                    unhealthy: 0
                    failing: 0
                - method:
                     healthy: 80
                     unhealthy: 0
                     failing: 0
                - conditional:
                    healthy: 70
                    unhealthy: 0
                    failing: 0
      - html_report:
           name: "Savanna Code Coverage"
           dir: "savanna/tests/cover"
           files: "index.html"
           keepAll: true
           wrappername: "htmlpublisher-wrapper.html"

